(let (
(type &mass         Float)
(type *position     [Float 3])
(type *acceleration [Float 3])
(type *velocity     [Float 3])

(fun (dot (x [Float 3]) (y [Float 3]) : Float)
  (f.reduce3 f.+ (f.* x y)))

(fun (vec-+ (x [Float 3]) (y [Float 3]) : [Float 3])
  (f.+ x y))

(fun (accel
  (epsilon Float)
  (x_pos   *position)
  (x_mass  &mass)
  (y_pos   *position)
  (y_mass  &mass) : *acceleration)
  (let
    ((val r      (f.- x_pos y_pos))
     (val rsqr   (f.+ (dot r r) (f.* epsilon epsilon)))
     (val invr   (f./ 1.0 (f.^ rsqr (f./ 1.0 2.0))))
     (val invr3  (f.* (f.* invr invr) invr))
     (val s      (f.* y_mass invr3)))
    (f.* s r))))

(accel 1.0 [12.0 2.2 8.0] 5.0 [1.0 2.0 3.0] 12.0)
)